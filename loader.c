#include "funcs.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Погрузчик.
void loader(uint* storage, _Bool* storage_stat, ushort count)
{
	// Переменная хранящая случайный номер склада.
	uint stor_n;
	// Количество товара загружаемого на склад.
	uint stor_cnt;

	while(!exit_status) {
		stor_n = my_rand(0, count);
		printf("Погрузчик: выбран склад %d\n", stor_n+1);
		// Проверка что склад не занят.
		if (storage_stat[stor_n] == STOR_BUSY){
			printf("Погрузчик: склад %d занят.\n", stor_n+1);
			continue;
		}
		// Занимаем склад.
		storage_stat[stor_n] = STOR_BUSY;
		stor_cnt = my_rand(200, 300);
		printf("Погрузчик: загружаю на склад %d товара %d.\n", stor_n+1, stor_cnt);
		storage[stor_n] += stor_cnt;
		// Освобождаем склад.
		printf("Погрузчик: выхожу со склада %d.\n", stor_n+1);
		storage_stat[stor_n] = STOR_FREE;

		sleep(2);

	}

}

//struct loader_thr_params {
//	uint* storage;
//	_Bool* storage_stat;
//	ushort count;
//};

void *loader_thr_wrapper(void *in_parms)
{
	struct loader_thr_params *parms = in_parms;
	loader(parms->storage, parms->storage_stat, parms->count);
	return 0;
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Выдает число в диапазоне от start до end.
ushort my_rand(ushort start, ushort end)
{
	static uint sinit = 0;
	if(!sinit) {
		sinit = time(NULL);
		srand(sinit);
	}

	return start + rand() % (end - start);
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////


